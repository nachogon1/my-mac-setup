#!/usr/bin/env bash
# Fix MOV file timestamps based on CreationDate or QuickTime:CreateDate

for file in "$@"; do
  echo "Processing $file ..."

  # Extract CreationDate (may include offset)
  creation=$(exiftool -s -s -s -CreationDate "$file")

  if [[ -n "$creation" ]]; then
    # Strip offset if present (+HH:MM or -HH:MM)
    clean_date=$(echo "$creation" | sed -E 's/[+-][0-9]{2}:[0-9]{2}$//')
    echo " Using CreationDate: $clean_date"
  else
    # Fallback to QuickTime:CreateDate (always UTC, no offset)
    clean_date=$(exiftool -s -s -s -QuickTime:CreateDate "$file")
    echo " Using QuickTime:CreateDate: $clean_date"
  fi

  # Apply as FileModifyDate
  if [[ -n "$clean_date" ]]; then
    exiftool -overwrite_original "-FileModifyDate=$clean_date" "$file"
  else
    echo " ⚠️ No usable date found for $file"
  fi
done
